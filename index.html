<!DOCTYPE html>
<meta charset="utf-8">
<style>
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}
form {
  position: absolute;
  right: 10px;
  top: 210px;
  display: box;
  float: right;
}
.node {
  border: solid 1px white;
  font: 10px sans-serif;
  line-height: 12px;
  overflow: hidden;
  position: absolute;
  text-indent: 2px;
}
h1,h2,h3{
  text-align:center;
}

</style>

<script src="http://d3js.org/d3.v3.min.js"></script>
<body>
  <h1>Treemaps showing the Profits and sales of coffee of all kinds in a given day by state and region </h1>
  <h2>Homework 4 Data visualization Theory and Practice</h2>
  <h3>By: Andrea Arismendy</h3>
  <p>(Hover over data to find detail at the bottom)</p>
</body>
<form>
  <label><input type="radio" name="mode" value="profit" checked> Profit</label>
  <label><input type="radio" name="mode" value="sales"> Sales</label>
</form>
<script>
var margin = {top: 5, right: 10, bottom: 10, left: 10},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
var color = d3.scale.category10();

var div = d3.select("body").append("div")
    .style("position", "relative")
    .style("width", (width + margin.left + margin.right) + "px")
    .style("height", (height + margin.top + margin.bottom) + "px")
    .style("left", margin.left + "px")
    .style("top", margin.top + "px");
var div1=d3.select("body").append("div")
    .attr("class","label")
    .style("fill","black")
    .style("position","relative")
    .style("height","15px")
    .style("width","30px")
    .style("opacity", .9);
 
      
  
d3.csv("coffee.csv", function(root) {
  var nest=d3.nest()
      .key(function(){return "rootNode";})
      .key(function(d){return d.region;})
      .key(function(d){return d.state;})
      .entries(root);
      
  var treemap = d3.layout.treemap()
      .size([width, height])
      .sticky(true)
      .children(function(d){return d.values;})
      .value(function(d) { return +d.profit; })
      .nodes(nest[0]);
 
  var node = div.datum(nest[0]).selectAll(".node")
      .data(treemap)
      .enter().append("div")
      .attr("class", "node")
      .call(position)
      .style("background", function(d) { return  d.children ?  null:color(d.region); })
       .on("mouseover",function(d){
          div1.transition()
          .duration(200)
          .text("Region:"+d.region+"\n"+"State:"+d.state+"\n"+"Value:"+d.profit+"\n"+"Sales:"+d.sales+"\n"+"Date:"+d.date);
       });
     
  d3.selectAll("input").on("change", function change() {
    var variable= this.value === "profit" ? function(d) { return d.profit; } : function(d) { return d.sales; };
   var treemap = d3.layout.treemap()
      .size([width, height])
      .sticky(true)
      .children(function(d){return d.values;})
      .value(function(d) { return +d.sales; })
      .nodes(variable);  
  var node = div.datum(variable).selectAll(".node")
      .data(treemap)
      .transition()
      .duration(2500)
      .attr("class", "node")
      .call(position)
      .style("background", function(d) { return  d.children ?  null:color(d.state); })
      
  });
});
function position() {
  this.style("left", function(d) { return d.x + "px"; })
      .style("top", function(d) { return d.y + "px"; })
      .style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })
      .style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; });
}
</script>
